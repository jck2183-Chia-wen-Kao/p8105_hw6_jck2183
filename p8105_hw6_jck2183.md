p8105\_hw6\_jck2183
================

## Problem 1

Import data

``` r
url <- "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv"

download.file(url, destfile = "./data/homicide-data.csv")

homicide_df = 
    read_csv("./data/homicide-data.csv", na = c("", "NA", "Unknown")) %>% 
    mutate(
    city_state = str_c(city, state, sep = ", "),
    victim_age = as.numeric(victim_age),
    resolution = case_when(
      disposition == "Closed without arrest" ~ 0,
      disposition == "Open/No arrest"        ~ 0,
      disposition == "Closed by arrest"      ~ 1)
  ) %>% 
  filter(
    victim_race %in% c("White", "Black"),
    city_state != "Tulsa, AL") %>% 
  select(city_state, resolution, victim_age, victim_race, victim_sex)
```

    ## Parsed with column specification:
    ## cols(
    ##   uid = col_character(),
    ##   reported_date = col_double(),
    ##   victim_last = col_character(),
    ##   victim_first = col_character(),
    ##   victim_race = col_character(),
    ##   victim_age = col_double(),
    ##   victim_sex = col_character(),
    ##   city = col_character(),
    ##   state = col_character(),
    ##   lat = col_double(),
    ##   lon = col_double(),
    ##   disposition = col_character()
    ## )

Start with one city

``` r
baltimore_df =
  homicide_df %>% 
  filter(city_state == "Baltimore, MD")

glm(resolution ~ victim_age + victim_race + victim_sex, 
    data = baltimore_df,
    family = binomial()) %>% 
  broom::tidy() %>% 
  mutate(
    OR = exp(estimate),
    CI_lower = exp(estimate - 1.96 * std.error),
    CI_upper = exp(estimate + 1.96 * std.error)
  ) %>% 
  select(term, OR, starts_with("CI")) %>% 
  knitr::kable(digits = 3)
```

| term              |    OR | CI\_lower | CI\_upper |
| :---------------- | ----: | --------: | --------: |
| (Intercept)       | 1.363 |     0.975 |     1.907 |
| victim\_age       | 0.993 |     0.987 |     1.000 |
| victim\_raceWhite | 2.320 |     1.648 |     3.268 |
| victim\_sexMale   | 0.426 |     0.325 |     0.558 |

Try across city.

``` r
models_results_df = 
  homicide_df %>% 
  nest(data = -city_state) %>% 
  mutate(
    models = 
      map(.x = data, ~glm(resolution ~ victim_age + victim_race + victim_sex, data = .x, family = binomial())),
    results = map(models, broom::tidy)
  ) %>% 
  select(city_state, results) %>% 
  unnest(results) %>% 
  mutate(
    OR = exp(estimate),
    CI_lower = exp(estimate - 1.96 * std.error),
    CI_upper = exp(estimate + 1.96 * std.error)
  ) %>% 
  select(city_state, term, OR, starts_with("CI")) 
```

``` r
models_results_df %>% 
  filter(term == "victim_sexMale") %>% 
  mutate(city_state = fct_reorder(city_state, OR)) %>% 
  ggplot(aes(x = city_state, y = OR)) + 
  geom_point(color = "#A35E60") + 
  geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper)) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

<img src="p8105_hw6_jck2183_files/figure-gfm/unnamed-chunk-4-1.png" width="90%" />

## Problem 2

Import Data

``` r
birth_df = 
  read_csv("./data/birthweight.csv", col_names = TRUE) %>% 
    janitor::clean_names() %>% 
    mutate(
        babysex = as.factor(babysex), 
        babysex = recode(babysex,
                         "1" = "male", 
                         "2" = "female"), 
                frace = as.factor(frace),
                frace = recode(
                    frace, 
                    "1" = "White", 
                    "2" = "Black", 
                    "3" = "Asian", 
                    "4" = "Puerto Rican", 
                    "8" = "Other", 
                    "9" = "Unknown"), 
        malform = as.factor(malform),
        malform = recode(
            malform,
            "0" = "absent", 
            "1" = "present"),
        mrace = as.factor(mrace),
        mrace = recode(
            frace, 
            "1" = "White", 
            "2" = "Black", 
            "3" = "Asian", 
            "4" = "Puerto Rican", 
            "8" = "Other", 
            "9" = "Unknown"),
        delwt = round(conv_unit(delwt, "lbs", "g"), digits = 0),
        ppwt = round(conv_unit(ppwt, "lbs", "g"), digits = 0),
        wtgain = round(conv_unit(wtgain, "lbs", "g"), digits = 0),
        mheight = round(conv_unit(mheight, "inch", "cm"), digits = 0)
    )
```

    ## Parsed with column specification:
    ## cols(
    ##   .default = col_double()
    ## )

    ## See spec(...) for full column specifications.

Fit a model : One using length at birth and gestational age as
predictors (main effects only).

``` r
model_maineff = lm(bwt ~ blength + gaweeks, data = birth_df) 
    

model_maineff %>% 
    broom::tidy() %>% 
    select(term, estimate, p.value) %>% 
    rename(
        "Term" = term, 
        "Estimate" = estimate, 
        "P-Value" = p.value
    ) 
```

    ## # A tibble: 3 x 3
    ##   Term        Estimate `P-Value`
    ##   <chr>          <dbl>     <dbl>
    ## 1 (Intercept)  -4348.   0.      
    ## 2 blength        129.   0.      
    ## 3 gaweeks         27.0  2.36e-54

``` r
birth_df %>% 
    add_residuals(model_maineff) %>%
    add_predictions(model_maineff) %>% 
    ggplot(aes(x = pred, y = resid)) + 
    geom_point()
```

<img src="p8105_hw6_jck2183_files/figure-gfm/unnamed-chunk-7-1.png" width="90%" />

Fit another model : One using head circumference, length, sex, and all
interactions (including the three-way interaction) between these.

``` r
model_interaction = 
    lm(bwt ~ bhead * blength * babysex, data = birth_df) 

    
model_interaction %>%     
    broom::tidy() %>% 
    select(term, estimate, p.value) %>% 
    rename(
        "Term" = term, 
        "Estimate" = estimate, 
        "P-Value" = p.value
    ) 
```

    ## # A tibble: 8 x 3
    ##   Term                         Estimate    `P-Value`
    ##   <chr>                           <dbl>        <dbl>
    ## 1 (Intercept)                 -7177.    0.0000000149
    ## 2 bhead                         182.    0.00000184  
    ## 3 blength                       102.    0.0000992   
    ## 4 babysexfemale                6375.    0.000147    
    ## 5 bhead:blength                  -0.554 0.478       
    ## 6 bhead:babysexfemale          -198.    0.000105    
    ## 7 blength:babysexfemale        -124.    0.000429    
    ## 8 bhead:blength:babysexfemale     3.88  0.000245

``` r
birth_df %>% 
    add_residuals(model_interaction) %>%
    add_predictions(model_interaction) %>% 
    ggplot(aes(x = pred, y = resid)) + 
    geom_point()
```

<img src="p8105_hw6_jck2183_files/figure-gfm/unnamed-chunk-9-1.png" width="90%" />

Compare the two model with Anova: H0: μ\_maineffect = μ\_interaction H1:
The means are not all equal.

``` r
anova(model_maineff, model_interaction) %>% 
    broom::tidy()
```

    ## # A tibble: 2 x 6
    ##   res.df        rss    df      sumsq statistic    p.value
    ##    <dbl>      <dbl> <dbl>      <dbl>     <dbl>      <dbl>
    ## 1   4339 481775846.    NA        NA        NA  NA        
    ## 2   4334 358816655.     5 122959191.      297.  4.74e-274

At 5% significance level, we can conclude that the average birth weight
for the model which only contains the main effect(length at birth and
gestational age) is different from the model including interaction
term(head circumference, length, sex, and all interactions between these
variables).

The variables I hypothesize that underlie baby’s birthweight include:
babysex, bhead, blength, delwt, gaweeks, momage, mrace, pnumlbw,
pnumsga, and smoken. And I will try to see individual predictor has
significant correlation with the birth weight or not.
